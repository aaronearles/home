services:
  kolibri:
    image: treehouses/kolibri:latest
    container_name: kolibri
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      # Fast local storage for databases and config
      - ./data/kolibri:/root/.kolibri
      # NAS storage for bulk content
      - /mnt/media/kolibri/content:/root/.kolibri/content/storage
    # ports:
    #   - "8080:8080"  # Using Traefik instead
    networks:
      - traefik
    labels:
      - traefik.enable=true
      - traefik.docker.network=traefik
      - traefik.http.routers.kolibri.rule=Host(`kolibri.internal.earles.io`)
      - traefik.http.routers.kolibri.entrypoints=websecure
      - traefik.http.routers.kolibri.tls.certresolver=production
      - traefik.http.services.kolibri.loadbalancer.server.port=8080

networks:
  traefik:
    external: true